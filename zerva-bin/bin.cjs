#!/usr/bin/env node
"use strict";var Fo=Object.create;var yr=Object.defineProperty;var Bo=Object.getOwnPropertyDescriptor;var Oo=Object.getOwnPropertyNames;var $o=Object.getPrototypeOf,Uo=Object.prototype.hasOwnProperty;var Ro=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Oo(t))!Uo.call(e,o)&&o!==r&&yr(e,o,{get:()=>t[o],enumerable:!(n=Bo(t,o))||n.enumerable});return e};var ot=(e,t,r)=>(r=e!=null?Fo($o(e)):{},Ro(t||!e||!e.__esModule?yr(r,"default",{value:e,enumerable:!0}):r,e));var nt=require("path"),it=require("fs"),Co=require("esbuild"),Lo=require("child_process");var Do=require("fs"),V=require("path");var _o=Object.defineProperty,i=(e,t)=>_o(e,"name",{value:t,configurable:!0});function j(e){return e!=null&&typeof e=="object"}i(j,"isObject");function st(e){return Object(e)!==e}i(st,"isPrimitive");function le(e){return Array.isArray(e)}i(le,"isArray");function Tr(e){return j(e)&&!le(e)}i(Tr,"isRecord");function Ar(e){return typeof e=="string"}i(Ar,"isString");function Mr(e){return typeof e=="number"}i(Mr,"isNumber");function Dr(e){return typeof e=="number"&&Number.isInteger(e)}i(Dr,"isInteger");function Pr(e){return typeof e=="number"&&Number.isSafeInteger(e)}i(Pr,"isSafeInteger");function Cr(e){return typeof e=="boolean"}i(Cr,"isBoolean");function Lr(e){return e==null}i(Lr,"isNullOrUndefined");function Fr(e){return j(e)&&e.constructor.name==="Uint8Array"}i(Fr,"isUint8Array");function ae(e,t,r=new WeakSet){if(e===t||r.has(t))return!0;if(st(t)||r.add(t),!(e instanceof Object)||!(t instanceof Object)||e.constructor!==t.constructor||e.length!==t.length)return!1;for(let n in e){if(!e.hasOwnProperty(n))continue;if(!t.hasOwnProperty(n))return!1;let o=e[n],s=t[n];if(!ae(o,s,r))return!1}for(let n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}i(ae,"deepEqual");function K(e,...t){for(let r of t)j(e)||(e={}),r!=null&&Object.keys(r).forEach(n=>{let o=e[n],s=r[n];Array.isArray(o)&&Array.isArray(s)?e[n]=o.concat(s):j(o)&&j(s)?e[n]=K(Object.assign({},o),s):e[n]=s});return e}i(K,"deepMerge");function Te(e={}){let{level:t=void 0,filter:r=void 0,colors:n=!0,levelHelper:o=!1,nameBrackets:s=!0,padding:l=16}=e,a=R(r),u=H(t);return c=>{if(!u(c.level)||!a(c.name))return;let h=c.name?`[${c.name}]`:"";switch(c.level){case 1:console.info(`I|*   ${h}`,...c.messages);break;case 2:console.warn(`W|**  ${h}`,...c.messages);break;case 3:console.error(`E|*** ${h}`,...c.messages);break;default:console.debug(`D|    ${h}`,...c.messages);break}}}i(Te,"LoggerConsoleHandler");var Br={"*":-1,a:-1,all:-1,d:0,dbg:0,debug:0,i:1,inf:1,info:1,w:2,warn:2,warning:2,e:3,err:3,error:3,fatal:4,off:1/0,"-":1/0};function at(e=""){let t=[Te()],r=2,n=i(u=>!0,"logCheckNamespace"),o=!1,s=l;function l(u="",c){function h(...d){f({name:u,messages:d,level:0})}i(h,"log"),h.label=u,h.active=!0,h.level=Ae(c!=null?c:-1),h.extend=function(d){return s(u?`${u}:${d}`:d)};let f=i(d=>{if(h.active===!0&&d.level>=a.level&&d.level>=h.level&&n(u))for(let v of t)v&&v(d)},"emit");return h.debug=function(...d){f({name:u,messages:d,level:0})},h.info=function(...d){f({name:u,messages:d,level:1})},h.warn=function(...d){f({name:u,messages:d,level:2})},h.error=function(...d){f({name:u,messages:d,level:3})},h.assert=function(d,...v){d||(typeof console!==void 0&&(console.assert?console.assert(d,...v):console.error(`Assert did fail with: ${d}`,...v)),f({name:u,messages:v||[`Assert did fail with: ${d}`],level:r}))},h.assertEqual=function(d,v,...m){let g=ae(d,v);g||h.assert(g,`Assert did fail. Expected ${v} got ${d}`,v,d,...m)},h.assertNotEqual=function(d,v,...m){let g=ae(d,v);g&&h.assert(g,`Assert did fail. Expected ${v} not to be equal with ${d}`,v,d,...m)},h}i(l,"LoggerBaseFactory");function a(u="",c){return s(u,c)}return i(a,"Logger"),a.registerHandler=function(u){t.push(u)},a.setFilter=function(u){n=R(u)},a.setLock=(u=!0)=>o=u,a.setHandlers=function(u=[]){s!==l&&(s=l),!o&&(t=[...u].filter(c=>typeof c=="function"))},a.level=-1,a.setLogLevel=function(u=-1){o||(a.level=u)},a.setFactory=function(u){o||(s=u)},a}i(at,"LoggerContext");function lt(e){return e===!0||e==="true"||e==="1"||typeof e=="number"&&e!==0?e="*":e===!1||e==="false"||e===0||e==="0"||e==null||e==="null"||e==="undefined"?e="":e=String(e),e}i(lt,"getNamespaceFilterString");var vr,wr,Io=lt(typeof process<"u"?(vr=process.env.ZEED)!=null?vr:process.env.DEBUG:typeof localStorage<"u"?(wr=localStorage.zeed)!=null?wr:localStorage.debug:"*");function R(e=Io){let t,r=[],n=[];if(!e)t=i(function(o){return!1},"fn");else if(e==="*")t=i(function(o){return!0},"fn");else{let o,s=e.split(/[\s,]+/),l=s.length;for(o=0;o<l;o++){if(!s[o])continue;let a=s[o].replace(/\*/g,".*?");a[0]==="-"?r.push(new RegExp("^"+a.substr(1)+"$")):n.push(new RegExp("^"+a+"$"))}t=i(function(a){if(r.length===0&&n.length===0)return!0;let u,c;for(u=0,c=r.length;u<c;u++)if(r[u].test(a))return!1;for(u=0,c=n.length;u<c;u++)if(n[u].test(a))return!0;return!1},"fn")}return t.accept=n,t.reject=r,t.filter=e,t}i(R,"useNamespaceFilter");var br,xr,Sr,Er,ko=typeof process<"u"?(xr=(br=process.env.ZEED_LEVEL)!=null?br:process.env.LEVEL)!=null?xr:process.env.DEBUG_LEVEL:typeof localStorage<"u"?(Er=(Sr=localStorage.zeed_level)!=null?Sr:localStorage.level)!=null?Er:localStorage.debug_level:void 0;function Ae(e){if(e===!1)return 1/0;if(typeof e=="number")return e;if(typeof e=="string"){let t=Br[e.toLocaleLowerCase().trim()];if(t!=null)return t}return-1}i(Ae,"parseLogLevel");function H(e=ko){let t=Ae(e);return r=>r>=t}i(H,"useLevelFilter");function Or(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;if(typeof globalThis<"u")return globalThis;throw new Error("unable to locate global object")}i(Or,"_global");function Y(){let e=Or();return e._zeedGlobal==null&&(e._zeedGlobal={}),e._zeedGlobal}i(Y,"getGlobalContext");var J;function Ee(){let e=at();return e.setHandlers([Te()]),e}i(Ee,"getLoggerContext");try{let e=Y();e!=null?(e==null?void 0:e.logger)==null?(J=Ee(),e.logger=J):J=e.logger:J=Ee()}catch{J=Ee()}var A=J,Q=i(()=>Date.now(),"getTimestamp");function Me(e){return e>999?(e/1e3).toFixed(1)+"s":e.toFixed(2)+"ms"}i(Me,"formatMilliseconds");function $r(...e){for(let t of e){if(t instanceof Date)return t;if(typeof t=="string"){let r=null;if(t.includes(":"))try{r=new Date(t)}catch{}if(!(r instanceof Date)){let n=/(\d\d\d\d)-(\d\d)-(\d\d)/.exec(t);n&&(r=new Date(+n[1],+n[2]-1,+n[3],12,0))}if(r instanceof Date)return r}}}i($r,"parseDate");var Nr=A("bin");function ht(e){let t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let o=0;o<r;o++)n[o]=t.codePointAt(o)||0;return n}i(ht,"_encodeUtf8Polyfill");function gt(e){let t=e.length,r="",n=0;for(;t>0;){let o=t<1e4?t:1e4,s=e.subarray(n,n+o);n+=o,r+=String.fromCodePoint.apply(null,s),t-=o}return decodeURIComponent(escape(r))}i(gt,"_decodeUtf8Polyfill");var De;function $e(e){if(De==null&&(De=ht,typeof TextEncoder<"u")){let t=new TextEncoder;De=i(r=>t.encode(r),"_textEncoder")}return De(e.normalize("NFC"))}i($e,"stringToUInt8Array");var Pe;function pt(e){if(Pe==null&&(Pe=gt,typeof TextDecoder<"u")){let t=new TextDecoder("utf-8",{ignoreBOM:!0});Pe=i(r=>t.decode(r),"_textDecoder")}return Pe(e).normalize("NFC")}i(pt,"Uint8ArrayToString");function D(e){return e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?$e(e):e.length?new Uint8Array(e):e}i(D,"toUint8Array");function Hr(...e){let t=0,r=e.flat(1).map(s=>{let l=D(s);return t+=l.length,l}),n=new Uint8Array(t),o=0;for(let s of r)n.set(s,o),o+=s.length;return n}i(Hr,"joinToUint8Array");function zr(e){if(typeof Buffer<"u")return Buffer.from(D(e)).toString("hex");let t="0123456789abcdef",r="";for(let n of[...D(e)])r+=t[n>>4]+t[n&15];return r}i(zr,"toHex");function mt(e){let t=D(e);if(typeof Buffer<"u")return Buffer.from(t).toString("base64");let r="";for(let n=0;n<t.byteLength;n++)r+=String.fromCharCode(t[n]);return btoa(r)}i(mt,"toBase64");function jr(e){let t=D(e);if(typeof Buffer<"u")return Buffer.from(t).toString("base64url");let r="";for(let n=0;n<t.byteLength;n++)r+=String.fromCharCode(t[n]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_")}i(jr,"toBase64Url");function Gr(e){if(typeof Buffer<"u"){let n=Buffer.from(e,"base64");return new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}i(Gr,"fromBase64");function yt(e,t){if(e.byteLength!==t.byteLength)return!1;let r=D(e),n=D(t);for(let o=0;o<r.length;o++)if(r[o]!==n[o])return!1;return!0}i(yt,"equalBinary");function Ue(e){try{return $e(JSON.stringify(e))}catch(t){throw Nr.warn("jsonToUint8Array",e),t}}i(Ue,"jsonToUint8Array");function Re(e){try{return JSON.parse(pt(e))}catch(t){throw Nr.warn("Uint8ArrayToJson",e),t}}i(Re,"Uint8ArrayToJson");function vt(e,t){if(typeof e!="string")if(e instanceof ArrayBuffer&&e.byteLength!==void 0)e=String.fromCharCode.apply(String,[].slice.call(new Uint8Array(e)));else if(Array.isArray(e))e=String.fromCharCode.apply(String,e);else if(e.constructor===Uint8Array)e=String.fromCharCode.apply(String,[].slice.call(e));else return!1;t=t||16;for(var r=[],n="0123456789ABCDEF",o=0;o<e.length;o+=t){var s=e.slice(o,Math.min(o+t,e.length)),l=("0000"+o.toString(16)).slice(-4),a=s.split("").map(c=>{var h=c.charCodeAt(0);return" "+n[(240&h)>>4]+n[15&h]}).join("");a+="   ".repeat(t-s.length);var u=s.replace(/[\x00-\x1F\x20]/g,".");u+=" ".repeat(t-s.length),r.push(l+" "+a+"  "+u)}return r.join(`
`)}i(vt,"Uint8ArrayToHexDump");function ne(e=16){let t=new Uint8Array(e);if(typeof crypto<"u"&&crypto.getRandomValues)crypto.getRandomValues(t);else for(let r=0;r<e;r++)t[r]=Math.floor(Math.random()*256);return t}i(ne,"randomUint8Array");var qr="SHA-256",wt="AES-GCM",Ur="PBKDF2";async function Wr(e,t=qr){return D(await crypto.subtle.digest(t,D(e)))}i(Wr,"digest");async function Zr(e,t={}){var o;let r=D(e),n=await crypto.subtle.importKey("raw",r,Ur,!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:Ur,salt:t.salt?D(t.salt):new Uint8Array(0),iterations:(o=t.iterations)!=null?o:1e5,hash:qr},n,{name:wt,length:256},!0,["encrypt","decrypt"])}i(Zr,"deriveKeyPbkdf2");var Ce=new Uint8Array([1,1]);async function bt(e,t){let r=ne(12),n=await crypto.subtle.encrypt({name:wt,iv:r},t,e),o=new Uint8Array(n),s=Ce.length+r.length+o.length,l=new Uint8Array(s),a=0;return l.set(Ce,a),a+=Ce.length,l.set(r,a),a+=r.length,l.set(o,a),l}i(bt,"encrypt");async function xt(e,t){let r=e.subarray(0,2);if(!yt(r,Ce))return Promise.reject(`Unknown magic ${r}`);let n=e.subarray(2,2+12),o=e.subarray(2+12,e.length),s=await crypto.subtle.decrypt({name:wt,iv:n},t,o);return new Uint8Array(s)}i(xt,"decrypt");var Rr=",",No=!1,Ho=!0;function Vr(e){return/^([-+])?([0-9]+(\.[0-9]+)?|Infinity)$/.test(e)?Number(e):NaN}i(Vr,"filterFloat");function Jr(e){return Ho&&e==null?"":No?'="'+String(e).replace(/"/g,'""')+'"':!isNaN(Vr(e))&&isFinite(e)?parseFloat(e):'"'+String(e).replace(/"/g,'""')+'"'}i(Jr,"escape");function Kr(e,t){let r="";t&&(r=t.join(Rr)+`\r
`);for(let n=0;n<e.length;n++)r+=e[n].map(Jr).join(Rr)+`\r
`;return r}i(Kr,"csv");function St(){return crypto.getRandomValues(new Uint32Array(1))[0]/4294967295}i(St,"getSecureRandom");function F(){return typeof crypto<"u"?St():Math.random()}i(F,"getSecureRandomIfPossible");function Yr(e=.25){return F()<e}i(Yr,"randomBoolean");function Qr(e=100,t=0){return t+Math.floor(F()*(e-t))}i(Qr,"randomInt");function Xr(e=100,t=0){return t+F()*(e-t)}i(Xr,"randomFloat");function en(e,t,r){return Math.max(e,Math.min(r,t))}i(en,"between");function Et(e){return e.reduce((t,r)=>t+r,0)}i(Et,"sum");function tn(e){return Et(e)/e.length}i(tn,"avg");function rn(e){return!/^1?$|^(11+?)\1+$/.test("1".repeat(e))}i(rn,"isPrimeRX");function nn(e){for(var t=2;t<e;t++)if(e%t===0)return!1;return e>1}i(nn,"isPrime");function Tt(e=""){let[t="",r="asc"]=e.split(" ");return r=r.toLowerCase(),{field:t,orderby:r,asc:r!=="desc",desc:r==="desc"}}i(Tt,"parseOrderby");function on(e,t=!0){return`${e} ${t?"asc":"desc"}`}i(on,"composeOrderby");function _e(e,t,r=!0){let n=e||0,o=t||0;return n>o?r?1:-1:n<o?r?-1:1:0}i(_e,"cmp");function sn(e,...t){if(t.length>0){let r=t.map(Tt),n=Array.from(e);return n.sort((o,s)=>{for(let{field:l,asc:a}of r){let u=_e(o[l],s[l],a);if(u!==0)return u}return 0}),n}return e}i(sn,"sortedOrderby");function de(e){return e.filter((t,r)=>e.indexOf(t)===r)}i(de,"arrayUnique");function At(e,t){return de(e.filter(r=>!t.includes(r)))}i(At,"arrayMinus");function Mt(...e){return de(e.reduce((t=[],r)=>t.concat(r),[]))}i(Mt,"arrayUnion");function k(...e){return e.flat(1/0)}i(k,"arrayFlatten");function Dt(e,t){return de(e).filter(r=>t.includes(r))}i(Dt,"arrayIntersection");function an(e,t){return At(Mt(e,t),Dt(e,t))}i(an,"arraySymmetricDifference");function Ie(e,t){if(e&&Array.isArray(e)){let r;for(;(r=e.indexOf(t))!==-1;)e.splice(r,1);return e}return[]}i(Ie,"arrayRemoveElement");function ln(e,t){return e.includes(t)||e.push(t),e}i(ln,"arraySetElement");function ke(e,t){return e.splice(0,e.length,...e.filter(t)),e}i(ke,"arrayFilterInPlace");function un(e,t){let r=e.findIndex(n=>n===t);return r>=0?e.splice(r,1):e.push(t),e}i(un,"arrayToggleInPlace");function cn(e){return e.splice(0,e.length),e}i(cn,"arrayEmptyInPlace");function Pt(e,t=_e){return Array.from(e).sort(t)}i(Pt,"arraySorted");function fn(e){return Pt(e,(t,r)=>t-r)}i(fn,"arraySortedNumbers");function Ct(e,t){return e.length===t.length&&e.every((r,n)=>r===t[n])}i(Ct,"arrayIsEqual");function Ne(e){return e.sort(()=>F()>.5?1:-1),e}i(Ne,"arrayShuffleInPlace");function dn(e){return Ne(Array.from(e))}i(dn,"arrayShuffle");function hn(e){for(;e.length>1;){let t=Array.from(e);if(Ne(t),!Ct(e,t))return t}return e}i(hn,"arrayShuffleForce");function gn(e){return e[Math.floor(F()*e.length)]}i(gn,"arrayRandomElement");function pn(...e){return k(e).reduce((t,r)=>t!=null?r>t?r:t:r,void 0)}i(pn,"arrayMax");function mn(...e){return k(e).reduce((t,r)=>t!=null?r<t?r:t:r,void 0)}i(mn,"arrayMin");function yn(...e){return k(e).reduce((t,r)=>t+r,0)}i(yn,"arraySum");function vn(...e){let t=k(e);return t.reduce((r,n)=>r+n,0)/t.length}i(vn,"arrayAvg");function wn(e,t){let r=[],n=0,o=e.length;for(;n<o;)r.push(e.slice(n,n+=t));return r}i(wn,"arrayBatches");function bn(e=0,t){if(e<=0)return[];let r=new Array(e);for(let n=0;n<e;n++)r[n]=t instanceof Function?t(n):t;return r}i(bn,"createArray");var zo=A("zeed:basex"),jo={2:"01",8:"01234567",11:"0123456789a",16:"0123456789abcdef",32:"0123456789ABCDEFGHJKMNPQRSTVWXYZ","32-rfc":"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567","32-hex":"0123456789ABCDEFGHIJKLMNOPQRSTUV","32-zbase":"ybndrfg8ejkmcpqxot1uwisza345h769",36:"0123456789abcdefghijklmnopqrstuvwxyz",58:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",62:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/","64-url":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",66:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.!~",85:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&()*+-;<=>?@^_`{|}~"};function N(e){let t;if(typeof e=="string")t=e;else if(t=jo[String(e)],t==null)throw new Error(`Unknown base ${e}`);if(t.length>=255)throw new TypeError("Alphabet too long");let r=new Uint8Array(256);for(let c=0;c<r.length;c++)r[c]=255;for(let c=0;c<t.length;c++){let h=t.charAt(c),f=h.charCodeAt(0);if(r[f]!==255)throw new TypeError(h+" is ambiguous");r[f]=c}let n=t.length,o=t.charAt(0),s=Math.log(n)/Math.log(256),l=Math.log(256)/Math.log(n);function a(c,h=-1){let f=D(c);if(f.byteLength===0)return"";let d=0,v=0,m=f.byteLength;for(;v!==m&&f[v]===0;)v++;let g=(m-v)*l+1>>>0,y=new Uint8Array(g);for(;v!==m;){let w=f[v],S=0;for(let x=g-1;(w!==0||S<d)&&x!==-1;x--,S++)w+=256*y[x]>>>0,y[x]=w%n>>>0,w=w/n>>>0;if(w!==0)throw zo.warn("Non-zero carry",f,h,S,g),new Error("Non-zero carry");d=S,v++}let p=g-d;for(;p!==g&&y[p]===0;)p++;let b="";for(;p<g;++p)b+=t.charAt(y[p]);return h>0?b.padStart(h,o):b}i(a,"encode");function u(c,h=-1){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;c=c.replace(/\s+/gi,"");let f=0,d=0;for(;c[f]===o;)f++;let v=(c.length-f)*s+1>>>0,m=new Uint8Array(v);for(;c[f];){let y=r[c.charCodeAt(f)];if(y===255)throw new Error(`Unsupported character "${c[f]}"`);let p=0;for(let b=v-1;(y!==0||p<d)&&b!==-1;b--,p++)y+=n*m[b]>>>0,m[b]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");d=p,f++}let g=v-d;for(;g!==v&&m[g]===0;)g++;return h>0?new Uint8Array([...new Uint8Array(h-m.length+g),...m.slice(g)]):m.slice(g)}return i(u,"decode"),{encode:a,decode:u}}i(N,"useBase");var{encode:Go,decode:qo}=N(16),{encode:Wo,decode:Zo}=N(32),{encode:Vo,decode:Jo}=N(58),{encode:Ko,decode:Yo}=N(62),{encode:Qo,decode:Xo}=N(62),Lt=i(e=>(e.length>0&&(/^[A-Z0-9_\-\ ]*$/g.test(e)&&(e=e.toLowerCase()),e=e.replace(/^[-_\ ]+/gi,"").replace(/[-_\ ]+$/gi,"").replace(/[-_\ ]+([a-z0-9])/gi,(t,r)=>r.toUpperCase()),e=e[0].toLowerCase()+e.substring(1)),e),"toCamelCase");function Ft(e){return e.charAt(0).toUpperCase()+e.toLowerCase().slice(1)}i(Ft,"toCapitalize");function xn(e){return e.replace(/\w\S*/g,Ft)}i(xn,"toCapitalizeWords");function Sn(e,t="-"){return t=typeof t>"u"?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}i(Sn,"fromCamelCase");function En(e,t){var r=[],n=[];return t==null&&(t=i(function(o,s){return r[0]===s?"[Circular ~]":"[Circular ~."+n.slice(0,r.indexOf(s)).join(".")+"]"},"cycleReplacer")),function(o,s){if(r.length>0){var l=r.indexOf(this);~l?r.splice(l+1):r.push(this),~l?n.splice(l,1/0,o):n.push(o),~r.indexOf(s)&&(s=t==null?void 0:t.call(this,o,s))}else r.push(s);return e==null?s:e.call(this,o,s)}}i(En,"serializer");function Le(e,t,r,n){return JSON.stringify(e,En(t,n),r)}i(Le,"jsonStringify");var Tn=["1","true","yes","y","on"];function An(e,t=!1){return e==null||typeof e!="string"?t:Tn.includes(String(e).trim().toLowerCase())}i(An,"stringToBoolean");function Mn(e,t=0){var r;return e==null||typeof e!="string"?t:(r=parseInt(e.trim(),10))!=null?r:t}i(Mn,"stringToInteger");function Dn(e,t=0){var r;return e==null||typeof e!="string"?t:(r=parseFloat(e.trim()))!=null?r:t}i(Dn,"stringToFloat");function He(e,t=!1){return e==null?t:typeof e=="boolean"?e:typeof e=="number"?e!==0:Tn.includes(String(e).trim().toLowerCase())}i(He,"valueToBoolean");function Pn(e,t=0){var r;return e==null?t:typeof e=="boolean"?e?1:0:typeof e=="number"?Math.floor(e):(r=parseInt(String(e).trim(),10))!=null?r:t}i(Pn,"valueToInteger");function Cn(e,t=0){var r;return e==null?t:typeof e=="boolean"?e?1:0:typeof e=="number"?Math.floor(e):(r=parseFloat(String(e).trim()))!=null?r:t}i(Cn,"valueToFloat");function Bt(e,t=""){var r;return e==null?t:(r=String(e))!=null?r:t}i(Bt,"valueToString");function Ot(e,t={}){let{trace:r=!0,pretty:n=!0}=t;return e.map(o=>o&&typeof o=="object"?n&&(o instanceof Uint8Array||o instanceof ArrayBuffer)?`
`+vt(o)+`
`:o instanceof Error?r?`${o.name||"Error"}: ${o.message}
${o.stack}`:`${o.name||"Error"}: ${o.message}`:n?Le(o,null,2):Le(o):String(o))}i(Ot,"formatMessages");function he(e,t={}){return Ot(e,t).join(" ")}i(he,"renderMessages");function Ln(e){try{return decodeURIComponent(escape(e))}catch{}return e}i(Ln,"fixBrokenUth8String");var es={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:Bn,fromCents:!1},Fn=i(e=>Math.round(e),"round"),ct=i(e=>Math.pow(10,e),"pow"),ts=i((e,t)=>Fn(e/t)*t,"rounding"),rs=/(\d)(?=(\d{3})+\b)/g,ns=/(\d)(?=(\d\d)+\d\b)/g;function _(e,t={}){return new I(e,t)}i(_,"currency");var ze=class{constructor(e,t={}){var s;let r=Object.assign({},es,t),n=ct((s=r.precision)!=null?s:2),o=ue(e,r);this.intValue=o,this.value=o/n,r.increment=r.increment||1/n,r.useVedic?r.groups=ns:r.groups=rs,this._settings=r,this._precision=n}add(e){let{intValue:t,_settings:r,_precision:n}=this;return _((t+=ue(e,r))/(r.fromCents?1:n),r)}subtract(e){let{intValue:t,_settings:r,_precision:n}=this;return _((t-=ue(e,r))/(r.fromCents?1:n),r)}multiply(e){let{intValue:t,_settings:r,_precision:n}=this;return _((t*=e)/(r.fromCents?1:ct(n)),r)}divide(e){let{intValue:t,_settings:r}=this;return _(t/=ue(e,r,!1),r)}distribute(e){let{intValue:t,_precision:r,_settings:n}=this,o=[],s=Math[t>=0?"floor":"ceil"](t/e),l=Math.abs(t-s*e),a=n.fromCents?1:r;for(;e!==0;e--){let u=_(s/a,n);l-- >0&&(u=u[t>=0?"add":"subtract"](1/a)),o.push(u)}return o}dollars(){return~~this.value}cents(){let{intValue:e,_precision:t}=this;return~~(e%t)}format(e){let{_settings:t}=this;return typeof e=="function"?e(this,t):t.format(this,Object.assign({},t,e))}toString(){let{intValue:e,_precision:t,_settings:r}=this;return ts(e/t,r.increment).toFixed(r.precision)}toJSON(){return this.value}static sum(...e){return k(e).reduce((t,r)=>_(t).add(r),this.zero)}static avg(...e){let t=k(e);return t.reduce((r,n)=>_(r).add(n),this.zero).divide(t.length)}},I=ze;i(I,"Currency");I.zero=new ze(0);I.one=new ze(1);I.hundred=new ze(100);function ue(e,t,r=!0){let n=0,{decimal:o,errorOnInvalid:s,precision:l,fromCents:a}=t,u=ct(l),c=typeof e=="number";if(e instanceof I&&a)return e.intValue;if(c||e instanceof I)n=e instanceof I?e.value:e;else if(typeof e=="string"){let h=new RegExp("[^-\\d"+o+"]","g"),f=new RegExp("\\"+o,"g");n=e.replace(/\((.*)\)/,"-$1").replace(h,"").replace(f,"."),n=n||0}else{if(s)throw Error("Invalid Input");n=0}return a||(n*=u,n=n.toFixed(4)),r?Fn(n):n}i(ue,"parse");function Bn(e,t){let{pattern:r,negativePattern:n,symbol:o,separator:s,decimal:l,groups:a}=t,u=(""+e).replace(/^-/,"").split("."),c=u[0],h=u[1];return(e.value>=0?r:n).replace("!",o).replace("#",c.replace(a,"$1"+s)+(h?l+h:""))}i(Bn,"format");var ce=864e5;function ge(e){return Math.floor(e/1e4)}i(ge,"dayYear");function je(e){return Math.floor(e/100%100)}i(je,"dayMonth");function $t(e){return Math.floor(e%100)}i($t,"dayDay");function On(e){return[ge(e),je(e),$t(e)]}i(On,"dayToParts");function Ge(e,t=!1){return t?new Date(`${Rt(e)}T00:00:00.000Z`):new Date(e/1e4,e/100%100-1,e%100)}i(Ge,"dayToDate");function $n(){return ie(new Date)}i($n,"dayFromToday");function Un(e,t=!1){if(typeof e=="number")return e<100?void 0:e;if(typeof e=="string")return qe(e);if(Array.isArray(e)&&e.length===3){let[r,n,o]=e;return pe(r,n,o)}else if(e instanceof Date)return ie(e,t)}i(Un,"dayFromAny");function Rn(e){return Ge(e,!0)}i(Rn,"dayToDateGMT");function ie(e,t=!1){return t?qe(e.toISOString()):e.getFullYear()*1e4+(e.getMonth()+1)*100+e.getDate()}i(ie,"dayFromDate");function _n(e){return ie(e,!0)}i(_n,"dayFromDateGMT");function fe(e,t=!0){return Ge(e,t).getTime()}i(fe,"dayToTimestamp");function Ut(e,t=!0){return ie(new Date(e),t)}i(Ut,"dayFromTimestamp");function Rt(e,t="-"){let r=String(e);return r.slice(0,4)+t+r.slice(4,6)+t+r.slice(6,8)}i(Rt,"dayToString");function pe(e,t=1,r=1){if(!(t<1||t>12||r<1||r>31))return e*1e4+t*100+r}i(pe,"dayFromParts");function qe(e){let t=String(e).replace(/[^0-9]/g,"").slice(0,8);if(t.length===8)return+t}i(qe,"dayFromString");function In(e,t=0){let r=ge(e),n=je(e);return t!==0&&(n+=t,r+=Math.floor((n-1)/12),n=Math.floor((n-1)%12)+1,n===0&&(n=12)),pe(r,n,1)}i(In,"dayMonthStart");function kn(e,t=0){let r=ge(e);return pe(r+t,1,1)}i(kn,"dayYearStart");function Nn(e,t){return Ut(fe(e)+t*ce)}i(Nn,"dayOffset");function Hn(e,t){return Math.round((fe(t)-fe(e))/ce)}i(Hn,"dayDiff");var{warn:_r}=A("zeed:promise");function _t(){let e,t;return[new Promise((n,o)=>{e=n,t=o}),e,t]}i(_t,"createPromise");async function zn(e){return new Promise(t=>setTimeout(t,e))}i(zn,"sleep");async function jn(){return new Promise(e=>setTimeout(e,0))}i(jn,"immediate");var It=Symbol("timeout");async function Gn(e,t,r=It){return new Promise(async(n,o)=>{let s=!1,l=setTimeout(()=>{s=!0,n(r)},t);try{let a=await e;clearTimeout(l),s||n(a)}catch(a){clearTimeout(l),s||o(a)}})}i(Gn,"timeout");var kt=new Error("Timeout reached");function qn(e){return e===It||e===kt}i(qn,"isTimeout");async function Nt(e,t){return t<=0?await e:new Promise(async(r,n)=>{let o=!1,s=setTimeout(()=>{o=!0,n(kt)},t);try{let l=await e;clearTimeout(s),o||r(l)}catch(l){clearTimeout(s),o||n(l)}})}i(Nt,"tryTimeout");function Wn(e,t,r=1e3){return new Promise((n,o)=>{let s=i(u=>{a&&(clearTimeout(a),l(),n(u))},"fn"),l=i(()=>{a=null,e.off?e.off(t,s):e.removeEventListener?e.removeEventListener(t,s):_r("No remove listener method found for",e,t)},"done"),a=setTimeout(()=>{l(),o(new Error("Did not response in time"))},r);e.on?e.on(t,s):e.addEventListener?e.addEventListener(t,s):_r("No listener method found for",e)})}i(Wn,"waitOn");function L(e){return Boolean(e&&(e instanceof Promise||typeof e.then=="function"))}i(L,"isPromise");function q(e){return Promise.resolve(e)}i(q,"promisify");var T=class{get value(){return this.days}constructor(e){var t;if(typeof e=="number"){this.days=e;return}if(e!=null&&(e=(t=T.from(e))==null?void 0:t.days),e==null){let r=new Date;this.days=r.getFullYear()*1e4+(r.getMonth()+1)*100+r.getDate()}else this.days=e}static fromNumber(e){return new T(e)}static fromString(e){return T.from(+e.replace(/[^0-9]/g,"").slice(0,8))}static fromDate(e,t=!1){return t?T.fromString(e.toISOString().substr(0,10)):T.from(e.getFullYear()*1e4+(e.getMonth()+1)*100+e.getDate())}static fromDateGMT(e){return T.fromDate(e,!0)}static from(e,t=!1){if(typeof e=="number")return e<100?void 0:new T(e);if(typeof e=="string")return T.fromString(e);if(Array.isArray(e)&&e.length===3){let[r,n=1,o=1]=e;return n<1||n>12||o<1||o>31?void 0:new T(r*1e4+n*100+o)}else{if(e instanceof Date)return T.fromDate(e,t);if(e instanceof T)return e}}toNumber(){return this.days}toJson(){return this.days}toString(e="-"){let t=String(this.days);return t.slice(0,4)+e+t.slice(4,6)+e+t.slice(6,8)}toDate(e=!1){return e?new Date(`${this.toString()}T00:00:00.000Z`):new Date(this.days/1e4,this.days/100%100-1,this.days%100)}toDateGMT(){return this.toDate(!0)}get year(){return Math.floor(this.days/1e4)}get month(){return Math.floor(this.days/100%100)}get day(){return Math.floor(this.days%100)}dayOffset(e){return T.fromDateGMT(new Date(this.toDateGMT().getTime()+e*ce))}monthStart(){return T.from([this.year,this.month,1])}yearStart(){return T.from([this.year,1,1])}monthOffset(e){let t=this.month+e,r=Math.floor((t-1)%12)+1;r===0&&(r=12);let n=Math.floor((t-1)/12);return T.from([this.year+n,r,this.day])}daysUntil(e){var t;return Math.round((((t=new T(e))==null?void 0:t.toDateGMT().getTime())-this.toDateGMT().getTime())/ce)}yesterday(){return this.dayOffset(-1)}tomorrow(){return this.dayOffset(1)}};i(T,"Day");async function Zn(e,t,r){let n=T.from(e),o=T.from(t);for(;n&&o&&(n==null?void 0:n.days)<=(o==null?void 0:o.days);){let s=r(n);L(s)&&await s,n=n.dayOffset(1)}}i(Zn,"forEachDay");function Vn(){return new T}i(Vn,"today");function Jn(e){return new T(e)}i(Jn,"day");function Kn(e){return T.fromDate(new Date(e)).days}i(Kn,"dateStringToDays");function Ht(e,t=2){return+(+e).toFixed(t)}i(Ht,"decimal");function Yn(e,t=2){return+(+e/Math.pow(10,t)).toFixed(t)}i(Yn,"decimalFromCents");function Qn(e,t=2){return Math.round(+e*Math.pow(10,t))}i(Qn,"decimalToCents");function Xn(e,t=2){return t*(Ht(e,t)%1)}i(Xn,"decimalCentsPart");var ei=i(e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"),"escapeHTML");var is=100,Ir=/[\u0000-\u001F\u0080-\u009F]/g,os=/^\.+/,ss=/\.+$/;function ft(){return/[<>:"/\\|?*\u0000-\u001F]/g}i(ft,"filenameReservedRegex");function ti(){return/^(con|prn|aux|nul|com\d|lpt\d)$/i}i(ti,"windowsReservedNameRegex");function We(e){if(typeof e!="string")throw new TypeError("Expected a string");let t="_";if(ft().test(t)&&Ir.test(t))throw new Error("Replacement string cannot contain reserved filename characters");return e=e.replace(ft(),t).replace(Ir,t).replace(os,t).replace(ss,""),e=ti().test(e)?e+t:e,e.slice(0,is)}i(We,"toValidFilename");var as=/[\\\-\[\]\/{}()*+?.^$|]/g;function ri(e){return e?e instanceof RegExp?e.source:e.replace(as,"\\$&"):""}i(ri,"escapeRegExp");function Fe(e){return e.reduce((t,r)=>Math.min(t,r.sort_weight||0),0)-1-F()}i(Fe,"startSortWeight");function Be(e){return e.reduce((t,r)=>Math.max(t,r.sort_weight||0),0)+1+F()}i(Be,"endSortWeight");function ni(e,t,r){let n=r.length,o=e<t;if(n<=0||e>=n-1)return Be(r);if(e<=0)return Fe(r);r=zt([...r]);let s=o?-1:0,l=r[e+s].sort_weight||0,u=(r[e+s+1].sort_weight||0)-l;if(u===0)return o?Fe(r):Be(r);let c=l+u/2,h=u*.01*(F()-.5);return c+h}i(ni,"moveSortWeight");function zt(e){return e.sort((t,r)=>(t.sort_weight||0)-(r.sort_weight||0)),e}i(zt,"sortedItems");var ls=/((?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?)/gim;function ii(e){return e.split(ls).map((t,r)=>{let n=ei(t);return r%2?`<a target="_blank" href="${n}">${jt(n)}</a>`:n}).join("")}i(ii,"linkifyPlainText");function jt(e){return e.replace(/^https?:\/\/(www\.)?/,"").replace(/\/$/,"")}i(jt,"toHumanReadableUrl");function Gt(e){let t=[];for(let[r,n]of Object.entries(e))if(n!=null){Array.isArray(n)||(n=[n]);for(let o of n)o!=null&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(String(o)))}return t.join("&")}i(Gt,"encodeQuery");function oi(e){let t={},r=(e[0]==="?"?e.substr(1):e).split("&");for(let n=0;n<r.length;n++){let o=r[n].split("="),s=decodeURIComponent(o[0]),l=decodeURIComponent(o[1]||"");t[s]!=null?(Array.isArray(t[s])||(t[s]=[t[s]]),t[s].push(l)):t[s]=l}return t}i(oi,"parseQuery");function si(e,t,r){let n=e[t];return n===void 0&&(n=r(t,e),e[t]=n),n}i(si,"ensureKey");async function ai(e,t,r){let n=e[t];return n===void 0&&(n=await r(t,e),e[t]=n),n}i(ai,"ensureKeyAsync");function li(e){return e!=null?e.size!=null?e.size:e.length!=null?e.length:Object.keys(e).length:0}i(li,"size");function ui(e){return e!=null&&e.length>0?e[e.length-1]:void 0}i(ui,"last");function ci(e){try{if(e!=null)return Array.isArray(e)||typeof e=="string"?e.length<=0:(e==null?void 0:e.size)!=null?e.size<=0:Object.keys(e).length<=0}catch(t){console.warn("Failed to check if empty for",e,t)}return!0}i(ci,"empty");function W(e){return Object(e)!==e?e:JSON.parse(JSON.stringify(e))}i(W,"cloneObject");function fi(e){return Object(e)!==e?e:JSON.parse(JSON.stringify(e))}i(fi,"cloneJsonObject");function di(e){let t=new Map;return r=>{if(t.has(r))return t.get(r);let n=e(r);return t.set(r,n),n}}i(di,"memoize");function hi(e,t){let r=[];for(let n=0;n<e;n++)r.push(t(n,e));return r}i(hi,"forTimes");var us=/\\\s|\s+|#[^\n]*\n?/gm,cs=/\(\?P?<(\w[\w\d_]+)>|\((?!\?(:|\!|=|<=|<\!))/gm,kr=/^((?:\(\?[\w$]+\))?)\(\?<([=!])([\s\S]*?)\)/gm,fs=A("xrx");function qt(e){return typeof e=="string"?e:e.source||""}i(qt,"regExpString");function gi(e){return e.replace(/[-\[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}i(gi,"regExpEscape");var pi=class{constructor(e,t){this.namedGroups={},this.names=[];let r=t!=null?t:"",n;if(e instanceof RegExp?(t==null&&(r=e.flags),n=e.source):n=e,r&&r.indexOf("x")!==-1&&(r=r.replace("x",""),n=n.replace(us,l=>l[0]==="\\"?l:"")),!(e instanceof RegExp)){let l=0;n=n.replace(cs,(a,u)=>(l+=1,u?(u!=="index"&&u!=="length"&&!this.namedGroups[u]?this.namedGroups[u]=l:fs.error(`Unallowed or duplicate group name: ${u}`),"("):a)),this.names=Object.keys(this.namedGroups)}n=qt(n),kr.lastIndex=0;let s=kr.exec(n);s&&(this.lookBehind={rx:new RegExp(`${s[3]}$(?!\\s)`),expect:s?s[2]==="=":!s},n=n.substr(s[0].length)),this.rx=new RegExp(n,r)}get lastIndex(){return this.rx.lastIndex}set lastIndex(e){this.rx.lastIndex=e}_handleMatch(e){if(this.lookBehind){let t=e.input.slice(0,e.index);if(this.lookBehind.expect!==this.lookBehind.rx.test(t))return null}for(let t of this.names)e[t]=e[this.namedGroups[t]];return e}exec(e){let t;for(;t=this.rx.exec(e);)if(this.rx.lastIndex===t.index&&this.rx.lastIndex++,t=this._handleMatch(t),t!=null)return t}execAll(e){let t=[],r;for(this.rx.lastIndex=0;r=this.exec(e);)t.push(r);return this.rx.lastIndex=0,t}replace(e,t){let r=typeof t=="function"?t:()=>t;return e.replace(this.rx,n=>r(n))}};i(pi,"XRX");var ds=A("dispose");async function mi(e){typeof e=="function"?await q(e()):L(e)?await e:typeof e.dispose=="function"?await q(e.dispose()):L(e.dispose)?await e.dispose:typeof e.cleanup=="function"?await q(e.cleanup()):L(e.cleanup)&&await e.cleanup}i(mi,"callDisposer");function Wt(e){let{name:t}=typeof e=="string"?{name:e}:e!=null?e:{},r=[],n=i(async l=>{l!=null&&r.includes(l)&&(ke(r,a=>a!==l),await mi(l))},"untrack"),o=i(async()=>{for(t&&ds.debug(`dispose ${t}: ${r.length} entries`);r.length>0;)await n(r[0])},"dispose"),s=i(l=>{if(l!=null)return r.unshift(l),()=>n(l)},"track");return Object.assign(o,{track:s,add:s,untrack:n,dispose:o,exec:o,getSize(){return r.length}})}i(Wt,"useDispose");function yi(e={}){let{mode:t="fifo"}=e,r=[],n=i(async(s=!1)=>{for(;r.length>0;){let l=r[0];if(ke(r,a=>a!==l),typeof l=="function"){let a=l();if(L(a)){if(s)throw new Error(`Expected sync only function, but found async: ${l}`);await a}}else if(L(l)){if(s)throw new Error(`Expected sync only function, but found async: ${l}`);await l}else throw new Error(`Unhandled disposable: ${l}`)}},"exec");return Object.assign(n,{add:i(s=>{t==="lifo"?r.unshift(s):r.push(s)},"add"),exec:n,getSize(){return r.length}})}i(yi,"useDefer");function vi(e,t=0){let r=setTimeout(e,t);return()=>{r&&(clearTimeout(r),r=void 0)}}i(vi,"useTimeout");function wi(e,t){let r=setInterval(e,t);return()=>{r&&(clearInterval(r),r=void 0)}}i(wi,"useInterval");function bi(e,t,r,...n){return e==null?()=>{}:(e.on?e.on(t,r,...n):e.addEventListener&&e.addEventListener(t,r,...n),()=>{e.off?e.off(t,r,...n):e.removeEventListener&&e.removeEventListener(t,r,...n)})}i(bi,"useEventListener");function xi(){let e=!0;return(t,r)=>{let n=!1;if(e){e=!1;try{t(),n=!0}finally{e=!0}}else r!==void 0&&r();return n}}i(xi,"useMutex");function Si(){let e=!0;return async(t,r)=>{let n=!1;if(e){e=!1;try{let o=t();L(o)&&await o,n=!0}finally{e=!0}}else if(r!==void 0){let o=r();L(o)&&await o}return n}}i(Si,"useAsyncMutex");var te=A("zeed:emitter"),z=class{constructor(){this.subscribers={},this.subscribersOnAny=[],this.dispose=Wt(),this.call=new Proxy({},{get:(e,t)=>(...r)=>this.emit(t,...r)})}async emit(e,...t){let r=!1;this.dispose.add(()=>{this.subscribers={},this.subscribersOnAny=[]});try{let n=this.subscribers[e]||[];if(this.subscribersOnAny.forEach(o=>o(e,...t)),n.length>0){let o=n.map(s=>{try{return q(s(...t))}catch(l){te.warn("emit warning:",l)}});r=!0,await Promise.all(o)}}catch(n){te.error("emit exception",n)}return r}onAny(e){this.subscribersOnAny.push(e)}on(e,t){let r=this.subscribers[e]||[];return r.push(t),this.subscribers[e]=r,()=>{this.off(e,t)}}onCall(e){for(let[t,r]of Object.entries(e))this.on(t,r)}once(e,t){let r=i(async(...n)=>(this.off(e,r),await q(t(...n))),"onceListener");return this.on(e,r),()=>{this.off(e,t)}}off(e,t){return this.subscribers[e]=(this.subscribers[e]||[]).filter(r=>t&&r!==t),this}removeAllListeners(){return this.subscribers={},this}};i(z,"Emitter");function Ei(){let e=Y().emitter;return e||(e=new z,Y().emitter=e),e}i(Ei,"getGlobalEmitter");var hs=new z;function Ti(e,t){let r=Math.round(F()*100);var n=[],o;let s=i((a,u)=>{let c={key:a,obj:u};n.push(c),o&&o()},"incoming");return t?e.on?e.on(t,a=>{s(t,a)}):e.addEventListener?e.addEventListener(t,a=>{s(t,a)}):te.error(r,"Cannot listen to key"):e.onAny?e.onAny((a,u)=>{s(a,u)}):te.error(r,"cannot listen to all for",e),i((a,u=!0)=>new Promise((c,h)=>{a||(a=t,a||n.length&&(a=n[0].key)),o=i(()=>{for(;n.length>0;){let f=n.shift();if(f.key===a)o=void 0,c(f.obj);else{if(u){te.warn(r,`Unhandled event ${a} with value: ${f.obj}`);continue}h(`Expected ${a}, but found ${f.key} with value=${f.obj}`),te.error(r,`Unhandled event ${a} with value: ${f.obj}`)}break}},"lazyResolve"),o()}),"on")}i(Ti,"lazyListener");var{encode:Zt,decode:Ai}=N(62),{encode:Mi,decode:gs}=N(32);function Ze(){return ne(16)}i(Ze,"uuidBytes");function oe(){return Zt(Ze(),22)}i(oe,"uuid");function Di(e){return Zt(e,22)}i(Di,"uuidEncode");function Pi(e){return Ai(e,16)}i(Pi,"uuidDecode");function Ci(){return Mi(Ze(),26)}i(Ci,"uuidB32");function Li(e){return Mi(e,26)}i(Li,"uuid32Encode");function Fi(e){return gs(e,16)}i(Fi,"uuid32Decode");var ut={};function re(e="id"){return ut[e]==null&&(ut[e]=0),`${e}-${ut[e]++}`}i(re,"uname");var ps=0;function Bi(){return`id-${ps++}`}i(Bi,"qid");var ms="10000000-1000-4000-8000-100000000000",ys=typeof crypto<"u"&&crypto.randomUUID!=null?crypto.randomUUID:()=>ms.replace(/[018]/g,e=>(e^ne(1)[0]&15>>e/4).toString(16)),Oi=16e11;function $i(e){var t=new Uint8Array([0,0,0,0,0,0]);let r=t.length-1;for(var n=0;n<t.length;n++){var o=e&255;t[r-n]=o,e=(e-o)/256}return t}i($i,"longToByteArray");function Vt(){let e=Q()-Oi;return new Uint8Array([...$i(e),...ne(10)])}i(Vt,"suidBytes");function Ui(){return Zt(Vt(),22)}i(Ui,"suid");function Ri(e){return Jt(Ai(e,16))}i(Ri,"suidDate");function Jt(e){return new Date(Oi+e.slice(0,6).reduce((t,r)=>t*256+r,0))}i(Jt,"suidBytesDate");function _i(e={}){let{maxParallel:t=3}=e,r=new z,n=0,o=0,s=0,l=0,a={};async function u(){if(n>0){let[g,y]=_t();return r.once("didFinish",y),g}}i(u,"waitFinishAll");function c(){r.emit("didFinish"),n=0,o=0}i(c,"didFinish");function h(){let g=0,y=0;for(let{max:p,resolved:b,state:w}of Object.values(a))g+=p,y+=w===2?p:Math.min(p,b);r.emit("didUpdate",n,o,g,y)}i(h,"didUpdate");function f(){if(h(),n>0&&n===o&&c(),s>=t)return;let g=Object.values(a).filter(y=>y.state===0);if(g.length>0){let y;for(let p of g)(y==null||p.priority<y.priority)&&(y=p);if(y!=null){let p=y.id,b=y.done;y.state=1,++s,r.emit("didStart",p);let w=i(S=>{y&&(y.result=S,y.state=2,y.resolved=y.max),--s,++o,f()},"taskFinished");y.task(y).then(S=>{b(S),r.emit("didResolve",p,S),w(S)}).catch(S=>{b(),r.emit("didReject",p,S),w()})}}}i(f,"performNext");function d(g){let y=a[g];y&&y.state===0&&(a[g].state=2,++o,r.emit("didCancel",g),h())}i(d,"cancel");function v(){Object.keys(a).forEach(d)}i(v,"cancelAll");function m(g,y={}){var S,x,B,O;let p,b=new Promise(E=>p=E),w=(S=y.id)!=null?S:oe();if(a[w]!=null){let E=(x=y.idConflictResolution)!=null?x:1;if(E===0)d(w);else if(E===1){let U=a[w];return{id:w,promise:(async()=>{if(U.state===2)return a[w].result})(),dispose:()=>d(w),cancel:()=>d(w)}}else throw new Error(`Pool task with id=${w} already exists!`)}return a[w]={id:w,task:g,priority:++l,state:0,max:(B=y.max)!=null?B:1,resolved:(O=y.resolved)!=null?O:0,done:p,payload:y.payload,setMax(E){a[w].max=E,h()},setResolved(E){a[w].resolved=E,h()},incResolved(E=1){a[w].resolved+=E,h()}},++n,f(),{id:w,promise:b,dispose:()=>d(w),cancel:()=>d(w)}}return i(m,"enqueue"),{events:r,cancel:d,cancelAll:v,enqueue:m,dispose:v,waitFinishAll:u}}i(_i,"usePool");var Ii=class extends z{constructor(e={}){super(),this.queue=[],this.waitToFinish=[],this.countMax=0,this.countResolved=0,this.paused=!1;let{name:t=re("queue"),logLevel:r}=e;this.name=t,this.log=A(`zeed:queue:${t}`,r!=null?r:1/0)}async performNext(){if(this.log("performNext, queue.length =",this.queue.length),this.currentTask!=null){this.log("performNext => skip while another task is running");return}if(this.paused){this.log("performNext => skip while is paused");return}for(;this.currentTask==null&&!this.paused;){let e=this.queue.shift();if(this.log(`performNext => ${e==null?void 0:e.name}`),e==null)break;this.countResolved===0&&this.emit("didStart",this.countMax);let{name:t,task:r,resolve:n}=e;this.currentTask=r();let o;try{this.log.info(`start task ${t}`),o=await this.currentTask,this.log(`finished task ${t} with result =`,o)}catch(s){this.log.warn("Error performing task",s)}n(o),this.currentTask=void 0,this.countResolved+=1,this.emit("didUpdate",this.countMax,this.countResolved)}for(this.queue.length===0&&(this.emit("didFinish"),this.countMax=0,this.countResolved=0);this.waitToFinish.length>0;)this.waitToFinish.shift()()}async enqueue(e,t={}){let{immediate:r=!1,name:n=re(this.name)}=t;return r?(this.log.info(`immediate execution ${n}`),await e()):(this.log(`enqueue ${n}`),new Promise(o=>{this.queue.push({name:n,task:e,resolve:o}),this.countMax+=1,this.emit("didUpdate",this.countMax,this.countResolved),this.performNext()}))}async enqueueReentrant(e,t={}){return this.enqueue(e,{immediate:this.currentTask!=null,name:t.name})}async cancelAll(e=!0){this.log("cancelAll"),this.emit("didCancel");let t=this.queue.map(r=>r.resolve);this.queue=[],t.forEach(r=>r(void 0)),await this.wait()}async pause(){this.log("pause"),this.paused=!0,await this.wait()}resume(){this.log("resume"),this.paused=!1,this.performNext()}async wait(){if(this.log("wait"),!(this.currentTask==null&&(this.queue.length===0||this.paused)))return new Promise(e=>{this.waitToFinish.push(e)})}get isPaused(){return this.paused}get hasTasks(){return this.queue.length!==0}};i(Ii,"SerialQueue");var ee=!1,X=ee?A("zeed:throttle"):()=>{};function ki(e,t={}){let{delay:r=100,trailing:n=!0,leading:o=!0}=t,s=0,l=0,a=0,u,c=Date.now();function h(){s&&(clearTimeout(s),s=void 0)}i(h,"clearExistingTimeout");function f(...d){let v=Date.now(),m=this,g=v-l;function y(){let b=Date.now();return`total ${(b-c).toFixed(1)}ms - elapsed ${(b-l).toFixed(1)}ms - visited ${a}x`}i(y,"debugElapsed");function p(){a=0,l=Date.now(),e.apply(m,d)}if(i(p,"exec"),u=p,g>r||!s){ee&&X("elapsed",y()),o&&(g>r?(ee&&X("\u{1F680} leading",y()),p()):++a);let b=g>r?r:r-g;X(`\u23F1 start timeout with ${b.toFixed(1)}ms`,y()),h(),l=v,s=setTimeout(()=>{ee&&X("\u23F1 reached timeout",y()),s=0,n&&(!o||a>0)&&(ee&&X("\u{1F680} trailing",y()),u==null||u())},b)}else++a,ee&&X("visited",y())}return i(f,"wrapper"),f.cancel=h,f.dispose=h,f}i(ki,"throttle");function Ni(e,t={}){let{delay:r=100}=t,n=0;function o(){n&&(clearTimeout(n),n=0)}i(o,"clearExistingTimeout");function s(...l){let a=this;o(),n=setTimeout(()=>{n=0,e.apply(a,l)},r)}return i(s,"wrapper"),s.cancel=o,s.dispose=o,s}i(Ni,"debounce");function Hi(e=(t=>(t=(r=>(r=globalThis==null?void 0:globalThis.location)==null?void 0:r.hostname)())!=null?t:"")()){return["::ffff:127.0.0.1","localhost","127.0.0.1","","::1","::"].includes(e)||e.startsWith("192.168.")||e.startsWith("10.0.")||e.endsWith(".local")}i(Hi,"isLocalHost");function zi(e){let{level:t=void 0,filter:r=void 0,messages:n=[]}=e,o=R(r),s=H(t);return l=>{!s(l.level)||!o(l.name)||n.push(l)}}i(zi,"LoggerMemoryHandler");var Kt=class extends z{constructor(){super(...arguments),this.id=oe()}close(){this.dispose()}};i(Kt,"Channel");var Oe=class extends Kt{constructor(){super(...arguments),this.isConnected=!0}postMessage(e){var t;(t=this.other)==null||t.emit("message",{data:e,origin:"local",lastEventId:oe()})}};i(Oe,"LocalChannel");function ji(){let e=new Oe,t=new Oe;return e.other=t,t.other=e,[e,t]}i(ji,"createLocalChannelPair");var Gi=class{async encode(e){return e}async decode(e){return e}};i(Gi,"NoopEncoder");var Ve=class{async encode(e){return Ue(e)}async decode(e){return Re(e)}};i(Ve,"JsonEncoder");var qi=class{constructor(e){this.key=e}async encode(e){let t=Ue(e);return await bt(t,this.key)}async decode(e){let t=await xt(e,this.key);return Re(t)}};i(qi,"CryptoEncoder");var dt=i((e,t,r={})=>new Proxy(r,{get:(n,o)=>o in n?n[o]:(...s)=>e(o,s,t)}),"createPromiseProxy");function Wi(e={}){let{name:t=re("hub"),encoder:r=new Ve,retryAfter:n=1e3,ignoreUnhandled:o=!0,logLevel:s=!1}=e,l=A(t,s),a={},u,c=[],h,f={},d=i(()=>{clearTimeout(h)},"dispose"),v=i(async()=>{if(clearTimeout(h),u){if(u.isConnected)for(;c.length;){let p=c[0];try{u.postMessage(await r.encode(p)),c.shift()}catch(b){l.warn("postMessage",b);break}}c.length>0&&n>0&&(h=setTimeout(v,n))}},"postNext"),m=i(async p=>{l("enqueue postMessage",p),c.push(p),await v()},"postMessage"),g=i(async p=>{u=p,u.on("connect",v),u.on("message",async b=>{l("onmessage",typeof b);let{name:w,args:S,id:x,result:B,error:O}=await r.decode(b.data);if(w){l(`name ${w} id ${x}`);try{if(a[w]==null)throw new Error(`handler for ${w} was not found`);let E=a[w](...S);L(E)&&(E=await E),l(`result ${E}`),x&&m({id:x,result:E})}catch(E){let U=E instanceof Error?E:new Error(Bt(E));l.warn("execution error",U.name),m({id:x,error:{message:U.message,stack:U.stack,name:U.name}})}}else if(x)if(l(`response for id=${x}: result=${B}, error=${O}`),f[x]==null)B===void 0?l(`skip response for ${x}`):l.warn(`no response hook for ${x}`);else{let[E,U]=f[x];if(E&&U)if(delete f[x],O){let Se=new Error(O.message);Se.stack=O.stack,Se.name=O.name,l.warn("reject",Se.name),U(Se)}else l("resolve",B),E(B)}else o||l.warn("Unhandled message",b)}),v()},"connect"),y=i(async(p,b,w={})=>{let{timeout:S=5e3}=w,x=oe();return m({name:p,args:b,id:x}),Nt(new Promise((B,O)=>f[x]=[B,O]),S)},"fetchMessage");return e.channel&&g(e.channel),{dispose:d,connect:g,listen(p){Object.assign(a,p)},send(){return dt(y,{},{options(p){return dt(y,{...p})}})}}}i(Wi,"useMessageHub");var Yt=class extends z{constructor(e){var s;super(),this.publish=this.emit,this.subscribe=this.on;let{name:t,encoder:r=new Ve,channel:n,debug:o=!1}=e;this.channel=n,this.encoder=r,this.debug=o,this.name=(s=t!=null?t:this.channel.id)!=null?s:re("pubsub"),this.log=A(`${this.shortId}`),this.debug&&(this.channel.on("connect",()=>{this.log("channel connected")}),this.channel.on("disconnect",()=>{this.log("channel disconnected")})),this.channel.on("message",async({data:l})=>{let a=await this.encoder.decode(l);if(this.debug?this.log(`channel message, event=${a==null?void 0:a.event}, info=`,a):this.log(`channel message, event=${a==null?void 0:a.event}`),a){let{event:u,args:c}=a;await this.emitSuper(u,...c)}})}get shortId(){return this.name.substr(0,6)}async emitSuper(e,...t){return await super.emit(e,...t)}async emit(e,...t){try{if(this.debug?this.log(`emit(${String(e)})`,e):this.log(`emit(${String(e)})`,t.length),!this.channel.isConnected)return this.log.warn("channel not connected"),!1;let r=await this.encoder.encode({event:e,args:t});return this.channel.postMessage(r),!0}catch(r){this.log.warn(`emit(${String(e)})`,r)}return!1}};i(Yt,"PubSub");function Zi(e){return new Yt(e)}i(Zi,"usePubSub");var vs=1,Vi=i(e=>e,"defaultSerialize"),ws=Vi;function Ji(e,t){let{post:r,on:n,eventNames:o=[],serialize:s=Vi,deserialize:l=ws}=t,a=new Map;return n(async u=>{let c=l(u),[h,f,d,v]=c;if(h===1||h===2){let m,g;if(v!=null)try{m=await e[v](...f)}catch(y){g=String(y)}else g="Method implementation missing";h===1&&d&&r(s(g?[4,g,d]:[3,m,d]))}else if(d){let m=a.get(d);m!=null&&(h===4?m.reject(f):m.resolve(f)),a.delete(d)}}),new Proxy({},{get(u,c){let h=i((...d)=>{r(s([2,d,null,c]))},"sendEvent");if(t.onlyEvents||o.includes(c))return h.asEvent=h,h;let f=i((...d)=>new Promise((v,m)=>{let g=vs++;a.set(g,{resolve:v,reject:m}),r(s([1,d,g,c]))}),"sendCall");return f.asEvent=h,f}})}i(Ji,"useRPC");var G=A("network"),Qt={cache:"no-cache",redirect:"follow",headers:{}};function Xt(e){let t=/:\/\/([^@]*)@/gi.exec(e);if(t&&t[1]){let[r,n]=t[1].split(":",2);return{url:e.replace(t[1]+"@",""),username:r,password:n}}}i(Xt,"parseBasicAuth");async function Je(e,t={},r=fetch){try{le(t)&&(t=K({},...k(t)));let n=Xt(String(e));n&&(e=n.url,t=K({},t,er(n.username,n.password))),t.headers!=null&&!(t.headers instanceof Headers)&&(t.headers=new Headers(t.headers)),G("fetch",e,t);let o=await r(String(e),t);if(o.status<400)return o;try{G.warn(`Fetch of ${e} with ${t} returned status=${o.status}`),G.warn(`Response: ${await o.text()}`)}catch(s){G.error("Exception:",s)}}catch(n){G.error("fetchBasic",n)}}i(Je,"fetchBasic");async function Ki(e,t={},r=fetch){try{let n=await Je(e,[{method:"GET",headers:{Accept:"application/json"}},t],r);if(n)return await n.json()}catch(n){G.error("fetchJSON error:",n)}}i(Ki,"fetchJson");async function Yi(e,t={},r=fetch){try{let n=await Je(e,[Qt,{method:"GET"},t],r);if(n)return await n.text()}catch(n){G.error("fetchHTML error:",n)}}i(Yi,"fetchText");function Qi(e,t="POST"){return{method:t,...Qt,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},body:Gt(e)}}i(Qi,"fetchOptionsFormURLEncoded");function Xi(e,t="POST"){return{method:t,...Qt,headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}}i(Xi,"fetchOptionsJson");function er(e,t){return{headers:{Authorization:"Basic "+mt(e+":"+t)}}}i(er,"fetchOptionsBasicAuth");function Ke(){if(typeof window<"u")return window}i(Ke,"getWindow");function tr(){if(typeof navigator<"u")return navigator}i(tr,"getNavigator");function eo(){var e;return((e=Ke())!=null?e:typeof WorkerGlobalScope<"u")?self:typeof global<"u"?global:Function("return this;")()}i(eo,"getGlobal");var M=tr(),P=Ke();function rr(e={ios:!1,macos:!1,windows:!1,beaker:!1,electron:!1,wkwebview:!1,pwa:!1,pwaInstalled:!1,browser:!1,node:!1,worker:!1,test:!1,jest:!1,macosNative:!1,iosNative:!1,appleNative:!1,touch:!1}){var t,r,n,o,s,l,a,u,c;return e.ios=((t=M==null?void 0:M.platform)==null?void 0:t.match(/(iPhone|iPod|iPad)/i))!=null,e.macos=!!((r=M==null?void 0:M.platform)!=null&&r.startsWith("Mac")),e.windows=!!((n=M==null?void 0:M.platform)!=null&&n.startsWith("Win")),e.beaker=(P==null?void 0:P.beaker)!=null,e.electron=(((s=(o=M==null?void 0:M.userAgent)==null?void 0:o.toLowerCase())==null?void 0:s.indexOf(" electron/"))||-1)>-1&&!e.beaker,e.wkwebview=((l=P==null?void 0:P.webkit)==null?void 0:l.messageHandlers)!=null,e.pwa=(M==null?void 0:M.serviceWorker)!=null,e.pwaInstalled=(M==null?void 0:M.standalone)||((u=(a=P==null?void 0:P.matchMedia)==null?void 0:a.call(P,"(display-mode: standalone)"))==null?void 0:u.matches),e.node=typeof process<"u"&&((c=process==null?void 0:process.release)==null?void 0:c.name)==="node",e.browser=!e.electron&&!e.wkwebview&&!e.node,e.worker=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,e.jest=typeof jest<"u"||typeof vitest<"u",e.test=e.jest,e.macosNative=e.wkwebview&&e.macos,e.iosNative=e.wkwebview&&e.ios,e.appleNative=e.wkwebview,e.touch=P&&"ontouchstart"in P||((M==null?void 0:M.maxTouchPoints)||0)>1||(M==null?void 0:M.msPointerEnabled)&&(P==null?void 0:P.MSGesture)||(P==null?void 0:P.DocumentTouch)&&document instanceof DocumentTouch,e}i(rr,"detect");var to=i(()=>typeof window<"u"&&globalThis===window,"isBrowser"),bs=rr();function ro(e){to()?window.addEventListener("beforeunload",e):typeof process<"u"&&process.on("exit",()=>e)}i(ro,"useExitHandler");var Fs=A("zeed:memstorage"),no=class{constructor(e={}){this.store={}}setItem(e,t){this.store[e]=W(t)}getItem(e){if(this.store.hasOwnProperty(e))return W(this.store[e])}removeItem(e){delete this.store[e]}clear(){this.store={}}allKeys(){return Object.keys(this.store)}};i(no,"MemStorage");var uo=require("child_process"),me=ot(require("fs"),1),fo=require("path"),C=require("fs"),we=require("path"),$=require("fs/promises"),se=require("path"),tt=require("fs"),rt=require("path"),fr=require("path"),xo=ot(require("tty"),1),Ye=ot(require("crypto"),1);function et(e={}){var d,v;let{args:t=process.argv.slice(1),alias:r={},normalize:n=Lt,booleanArgs:o=[],listArgs:s=[],numberArgs:l=[]}=e,a=Object.entries(r).reduce((m,g)=>{let[y,p]=g;typeof p=="string"&&(p=[p]);for(let b of p)m[n(b)]=n(y);return m},{}),u={_:[]};function c(m,g){u[m]==null||typeof u[m]=="boolean"?u[m]=g:Array.isArray(u[m])?u[m].push(g):u[m]=[u[m],g]}i(c,"setOpt");let h=[...t],f;for(;f=h.shift();){let m;if(/^--?/.test(f)){let g=f.replace(/^--?/,"");if(f.includes("=")){let[y,p]=g.split("=",2);g=y.trim(),m=p.trim()}g=n(g),g=(d=a[g])!=null?d:g,o.includes(g)?c(g,!0):(m=(v=m!=null?m:h.shift())!=null?v:"",l.includes(g)&&(m=Number(m!=null?m:0)),s.includes(g)?Array.isArray(u[g])?u[g].push(m):u[g]=[m]:c(g,m))}else u._.push(f)}return u}i(et,"parseArgs");function co(e){return new Promise(async(t,r)=>{let n=(0,uo.spawn)("pbcopy");n.on("error",o=>r(o)),n.on("close",()=>t(e)),n.stdin.write(e),n.stdin.end()})}i(co,"pbcopy");var ye=A("zeed:env"),xs=`
`,Ss=/^\s*([\w_.-]+)\s*=\s*(.*)?\s*$/,Es=/\\n/g,Ts=/\n|\r|\r\n/;function sr(e,t={}){let r={};return String(e).split(Ts).forEach(function(n,o){let s=n.match(Ss);if(s!=null){let l=s[1],a=s[2]||"",u=a.length-1,c=a[0]==='"'&&a[u]==='"';a[0]==="'"&&a[u]==="'"||c?(a=a.substring(1,u),c&&(a=a.replace(Es,xs))):a=a.trim(),r[l]=a}else ye.debug(`did not match key and value when parsing line ${o+1}: ${n}`)}),r}i(sr,"parse");function ar(e,t="."){return(0,fo.resolve)(process.cwd(),e!=null?e:t)}i(ar,"stringToPath");function lr(e,t=""){return e==null&&(e=t),ar(String(e).trim(),t)}i(lr,"valueToPath");var ur=lr;function ho(e={}){var o,s,l,a;let t=(s=e==null?void 0:e.path)!=null?s:ur((o=e==null?void 0:e.filename)!=null?o:".env"),r=(l=e==null?void 0:e.encoding)!=null?l:"utf8",n=(e==null?void 0:e.debug)||!1;n!==!0&&(ye.level=1/0);try{let u=me.default.existsSync(t)?sr(me.default.readFileSync(t,{encoding:r}),{debug:n}):{},c=me.default.existsSync(t+".local")?sr(me.default.readFileSync(t+".local",{encoding:r}),{debug:n}):{},h=Object.assign({},u,c),f=(a=e==null?void 0:e.env)!=null?a:process.env;return Object.entries(h).forEach(([d,v])=>{typeof(e==null?void 0:e.prefix)=="string"&&(d=(e==null?void 0:e.prefix)+d),Object.prototype.hasOwnProperty.call(f,d)?ye.debug(`"${d}" is already defined and will not be overwritten`):v!=null&&(ye.info(`set env.${d} = ${v}`),f[d]=v)}),{parsed:h}}catch(u){return ye.error(u),{error:u}}}i(ho,"setupEnv");var nr=A("zeed:filestorage"),go=class{constructor(e={}){var t,r,n,o;this.store={},this.fileKeys=void 0,this.pretty=!1,this.dirname=(0,we.resolve)(process.cwd(),e.path||".fileStorage"),this.pretty=!!e.pretty,this.extension=(t=e.extension)!=null?t:".json",e.extension&&!this.extension.startsWith(".")&&(this.extension="."+this.extension),this.extensionLength=this.extension.length,this.objectToString=(r=e.objectToString)!=null?r:s=>this.pretty?JSON.stringify(s,null,2):JSON.stringify(s),this.objectFromString=(n=e.objectFromString)!=null?n:s=>{try{return JSON.parse(s)}catch(l){nr.warn(`fileStorage parse error '${l}' in`,s)}},this.keyToFilename=(o=e.keyToFilename)!=null?o:We}setItem(e,t){this.store[e]=W(t);try{let r=this.objectToString(t),n=this.getPath(e);(0,C.mkdirSync)((0,we.dirname)(n),{recursive:!0}),(0,C.writeFileSync)(n,r,"utf8")}catch(r){nr.error("setItem error",r)}}getPath(e){return(0,we.resolve)(this.dirname,this.keyToFilename(e)+this.extension)}getBuffer(e){let t=this.getPath(e);return Buffer.from((0,C.readFileSync)(t))}getItem(e){let t=this.store[e];if(t!==null){if(t!=null)return W(t);try{let r=this.getPath(e),n=(0,C.readFileSync)(r,"utf8");if(n!=null){let o=this.objectFromString(n);return this.store[e]=o,o}}catch(r){nr.warn("getItem error",r),this.store[e]=null}}}removeItem(e){if(delete this.store[e],this.fileKeys!=null){let t=this.fileKeys.indexOf(e);t!==-1&&this.fileKeys.splice(t,1)}try{let t=this.getPath(e);(0,C.unlinkSync)(t)}catch{}}clear(){this.fileKeys=[],this.store={},(0,C.rmSync)(this.dirname,{recursive:!0,force:!0})}allKeys(){if(this.fileKeys==null)try{this.fileKeys=(0,C.readdirSync)(this.dirname,{withFileTypes:!0}).filter(t=>!t.isDirectory()&&t.name.endsWith(this.extension)).map(t=>t.name.slice(0,-this.extensionLength))||[]}catch{}let e=[...this.fileKeys||[]];for(let t of Object.keys(this.store))e.includes(t)||e.push(t);return e.sort(),e}};i(go,"FileStorage");function po(e){let t=(0,se.normalize)(e),r=process.env.HOME;return r&&t.startsWith(r)?"~"+t.slice(r.length):t}i(po,"toHumanReadableFilePath");async function xe(e){try{await(0,$.stat)(e)}catch{return!1}return!0}i(xe,"exists");async function mo(...e){let t=(0,se.join)(...e);return await xe(t)||await(0,$.mkdir)(t,{recursive:!0}),t}i(mo,"ensureFolder");async function yo(...e){let t=(0,se.join)(...e);return await xe(t)&&await(0,$.rm)(t,{recursive:!0}),t}i(yo,"removeFolder");async function vo(...e){let t=(0,se.join)(...e);if(await xe(t))return await(0,$.readFile)(t,"utf-8")}i(vo,"readText");async function wo(e,t){await(0,$.writeFile)(e,t,"utf-8")}i(wo,"writeText");var io={};function cr(e,t={}){let{level:r=-1,filter:n="*"}=t;e=(0,rt.resolve)(process.cwd(),e),(0,tt.mkdirSync)((0,rt.dirname)(e),{recursive:!0});var o=(0,tt.createWriteStream)(e,{flags:"a"});let s=R(n),l=H(r);return a=>{if(!l(a.level)||!s(a.name))return;let u=new Date().toISOString(),c=a.name||"",h=io[c||""];h==null&&(io[c]=h);let f=[`[${c||"*"}]`,he(a.messages,{pretty:!1})];function d(...v){o.write(v.join("	")+`
`)}switch(i(d,"write"),a.level){case 1:d(u,"I|*  ",...f);break;case 2:d(u,"W|** ",...f);break;case 3:d(u,"E|***",...f);break;default:d(u,"D|   ",...f);break}}}i(cr,"LoggerFileHandler");function dr(e){var t,r;return typeof e!="string"?[]:((r=(t=e==null?void 0:e.split(`
`))==null?void 0:t.map(n=>{let o=n.match(/^\s+at.*(\((.*)\)|file:\/\/(.*)$)|\s*at\s(\/.*)$/);if(o){let s=o[3]||o[2]||o[4];return s.endsWith(")")&&(s=s.slice(0,-1)),s}}))==null?void 0:r.filter(n=>n!=null))||[]}i(dr,"getStackLlocationList");var ir=(0,fr.resolve)(process.cwd()),oo,so,or=(oo=process.env)!=null&&oo.HOME?(0,fr.resolve)((so=process.env)==null?void 0:so.HOME):"";function hr(e){if(e.includes("/node_modules/"))return"";let t="file://";return e.startsWith(t)?e.substr(t.length):ir&&e.startsWith(ir)?e.substr(ir.length+1):(or&&e.startsWith(or)&&(e="~/"+e.substr(or.length+1)),e)}i(hr,"pathStripCwd");function bo(e){let t=e.match(/^\s*at.*(\((.*)\)|file:\/\/(.*)$)|\s*at\s(\/.*)$/);if(t){let r=t[3]||t[2]||t[4];return r.endsWith(")")&&(r=r.slice(0,-1)),r}return""}i(bo,"extractFileInfo");function Qe(e=2,t=!0){var r;let n=new Error().stack||"",o=(r=dr(n))==null?void 0:r[e];return o&&t&&(o=hr(o)),o||""}i(Qe,"getSourceLocation");function gr(){return new Error().stack||""}i(gr,"getStack");function pr(e,t=!0){let r="",n=new Error().stack||"";if(typeof n=="string"){let o=n.split(`
`).map(l=>l.trim()),s=o.findIndex(l=>e.some(a=>l.startsWith(a)));r=o[s+1],r&&(r=bo(r)),r&&t&&(r=hr(r))}return r}i(pr,"getSourceLocationByPrecedingPattern");function So(){try{return process.env.ZEED_COLOR!=null?He(process.env.ZEED_COLOR,!1):xo.default.isatty(process.stdout.fd)}catch{}return!1}i(So,"shouldUseColor");var ao=[6,2,3,4,5,1];function Eo(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return ao[Math.abs(t)%ao.length]}i(Eo,"selectColor");var lo={},As=Q();function ve(...e){process.stdout.write(he(e)+`
`)}i(ve,"log");var be={BOLD:"\x1B[1m",UNBOLD:"\x1B[2m",RED:"\x1B[31m",GREEN:"\x1B[32m",BLUE:"\x1B[34m",PURPLE:"\x1B[35m",GRAY:"\x1B[37m",ORANGE:"\x1B[38;5;208m",UNCOLOR:"\x1B[0m"},To="\x1B[0m";function Z(e,t){return`${t===8?be.ORANGE:"\x1B[3"+(t<8?t:"8;5;"+t)+"m"}${e}${To}`}i(Z,"colorString");function Xe(e,t,r=!0){return e.map(n=>{if(typeof n!="string")return n;let o=t,s=To;return r&&(o=`${be.BOLD}${o}`,s=`${s}${be.BOLD}`),`${o}${n}${s}`})}i(Xe,"colorStringList");var Ao="loggerStackTraceDebug-7d38e5a9214b58d29734374cdb9521fd964d7485";function mr(e={}){let{level:t=void 0,filter:r=void 0,colors:n=So(),levelHelper:o=!0,nameBrackets:s=!0,padding:l=0,fill:a=0,stack:u=!0}=e,c=R(r),h=H(t);return f=>{var d;if(!h(f.level)||!c(f.name))return;let v=Q(),m=f.name||"",g=lo[m||""];g==null&&(g={color:Eo(m)},lo[m]=g);let y=Me(v-As),p,b=s?`[${m}]`:m;if(l>0&&(b=b.padStart(l," ")),a>0&&(b=b.padEnd(a," ")),n){let x=g.color;p=[Z(b,x)+" | "],f.level===2?p.push(...Xe(f.messages,be.ORANGE)):f.level===3?p.push(...Xe(f.messages,be.RED)):p.push(...f.messages),p.push(Z(`+${y}`,x))}else p=[b,...f.messages],p.push(`+${y}`);if(((d=f.messages)==null?void 0:d[0])===Ao&&console.log(gr()),u){let x="";typeof u=="boolean"?(x=pr(["at Function.","at null.log (","at log ("],!0),x||(x=Qe(0,!0))):x=Qe(typeof u=="number"?u:3,!0),x&&p.push(Z(`(${x})`,7))}let w="|",S=".";switch(f.level){case 1:o&&(p[0]=`I${w}${S}   `+p[0]),ve(...p);break;case 2:o&&(p[0]=(n?Z(`W${w}${S}${S}  `,8):`W${w}${S}${S}  `)+p[0]),ve(...p);break;case 3:o&&(p[0]=(n?Z(`E${w}${S}${S}${S} `,1):`E${w}${S}${S}${S} `)+p[0]),ve(...p);break;default:o&&(p[0]=`D${w}    `+p[0]),ve(...p);break}}}i(mr,"LoggerNodeHandler");try{Ye.default&&Ye.default.webcrypto&&typeof globalThis<"u"&&typeof globalThis.crypto>"u"&&(globalThis.crypto=Ye.default.webcrypto)}catch(e){console.warn("Failed to polyfill webcrypto",e)}function Mo(){var r;let e=[mr({padding:32,nameBrackets:!1})],t=(r=process.env.ZEED_LOG)!=null?r:process.env.LOG;t&&e.unshift(cr(ur(t))),A.setHandlers(e)}i(Mo,"setupLogContextNode");Mo();function Po(){var r,n,o,s;let e={build:!1,help:!1,version:"",sourcemap:!0,external:[]};try{let l=require((0,V.resolve)(process.cwd(),"package.json"));e.version=l.version}catch{}try{let l=require((0,V.resolve)(process.cwd(),"zerva.conf.js"));l&&Object.assign(e,l)}catch{}let t=et({alias:{build:["b"]},booleanArgs:["build","noSourcemap"],listArgs:["external"]});if(e.help=t.help,e.sourcemap=!t.noSourcemap,e.external=(r=t.external)!=null?r:[],e.build=(n=t.build)!=null?n:t._.includes("build"),t._=Ie(t._,"build"),e.build?(e.outfile=(o=t.outfile)!=null?o:(0,V.resolve)("dist/main.cjs"),e.build=!0):(e.outfile=(s=t.outfile)!=null?s:(0,V.resolve)(".out.cjs"),e.entry=process.argv[2],process.env.NODE_OPTIONS="--enable-source-maps"),e.entry)e.entry=(0,V.resolve)(e.entry);else for(let l of Ms)if((0,Do.existsSync)((0,V.resolve)(l))){e.entry=l;break}return process.argv.splice(2,process.argv.length-2),console.log("config =",e),e}var Ms=["zerva.ts","zerva.js","service.ts","service.js","main.ts","main.js","zerva/main.ts","zerva/main.js","service/main.ts","service/main.js","src/zerva.ts","src/zerva.js","src/service.ts","src/service.js","src/main.ts","src/main.js","index.ts","index.js","zerva/index.ts","zerva/index.js","service/index.ts","service/index.js","src/index.ts","src/index.js"];function Ds(){var u,c,h;let e=Po();if(e.help){console.info(`usage: ${((h=(c=(u=process.argv)==null?void 0:u[1])==null?void 0:c.trim())==null?void 0:h.toLocaleLowerCase())||""} [options] <entryFile>

If started without arguments, the entry file is searched in default locations and the
debug server will be started. The files will be watched for changes and the debug server
is restarted on every update.

--build, -b         Build, else run debug server
--outfile, -o       Target file
--no-sourcemap      Do not emit source maps
--external=name     Exclude package from bundle (see esbuild)           
`);return}(!e.entry||!(0,it.existsSync)(e.entry))&&(console.error(`Zerva: Cannot find entry file: ${e.entry}`),process.exit(1)),process.argv.splice(2,process.argv.length-2);let t,r;async function n(){t&&(console.log(`Zerva: Stopping app
`),new Promise(f=>r=f),t.kill("SIGTERM"),t=void 0)}async function o(){await n(),t=(0,Lo.spawn)(process.execPath,[e.outfile],{cwd:process.cwd(),stdio:"inherit",env:{...process.env,ZERVA_MODE:"development",ZERVA_VERSION:e.version}}),console.info("Zerva: Starting app"),t.on("error",f=>{console.error("Node process error:",f)}),t.on("close",f=>{r&&(r(),r=void 0)})}function s(f){if(!e.build){let d=require("node-notifier");d&&d.notify({title:"Zerva Build Error",message:String(f),icon:(0,nt.resolve)(__dirname,"icon.png"),sound:!0})}}function l(f){let d=(0,nt.normalize)(f),v=process.env.HOME;return v&&d.startsWith(v)?"~"+d.slice(v.length):d}console.info(`Zerva: Building from "${l(e.entry)}"`),(0,Co.build)({target:"node10.4",bundle:!0,entryPoints:[e.entry],banner:{js:e.build?`#!/usr/bin/env node

// Generated by Zerva <https://holtwick.de/zerva>
`:`// Temporary Build. Generated by Zerva <https://holtwick.de/zerva>
`},footer:{},legalComments:"none",outfile:e.outfile,platform:"node",sourcemap:e.sourcemap,loader:{".json":"json"},define:{ZERVA_DEVELOPMENT:!e.build,ZERVA_PRODUCTION:e.build,ZERVA_VERSION:`"${e.version}"`,"process.env.ZERVA_DEVELOPMENT":!e.build,"process.env.ZERVA_PRODUCTION":e.build,"process.env.ZERVA_VERSION":`"${e.version}"`},minify:e.build,watch:e.build?!1:{onRebuild(f,d){n(),f?s(f):(console.info("Zerva: Rebuild succeeded."),o())}},external:["notifier","node-notifier","esbuild","vite"]}).then(f=>{try{(0,it.chmodSync)(e.outfile,493)}catch{}e.build?console.info(`Zerva: Building to "${l(e.outfile)}" succeeded.`):o()}).catch(f=>{s(f)})}Ds();
